# ‚úÖ Upload Playwright JSON result
- name: Upload raw test result JSON
  if: always()
  uses: actions/upload-artifact@v4
  with:
    name: Raw-Results-${{ matrix.group.name }}
    path: ./Playwright-Automation/test-results/report.json
    retention-days: 3




merge-reports: 
  needs: test 
  runs-on: ubuntu-latest-16-core-internal
  steps: 
    - name: Checkout repo
      uses: actions/checkout@v4

    # ‚úÖ Download all JSON result files
    - name: Download all raw result artifacts
      uses: actions/download-artifact@v4
      with:
        path: raw-collection

    # ‚úÖ List downloaded files
    - name: Debug: List raw JSON files
      run: |
        echo "üîç Verifying downloaded report.json files:"
        find raw-collection -name report.json

    - name: Set npm registry to Cloudflare mirror (avoid E503)
      run: npm config set registry https://registry.npmmirror.com/

    - name: Install dependencies
      run: npm ci
      working-directory: ./Playwright-Automation

    # ‚úÖ Merge Monocart JSON reports using monocart-reporter API
    - name: Merge Monocart reports using monocart-reporter
      run: node merge-monocart.mjs
      working-directory: ./Playwright-Automation

    - name: 'Debug: List merged report directory'
      run: |
        echo "Checking contents of merged-report:"
        ls -R merged-report || echo "merged-report folder not found"

    - name: Upload merged report
      uses: actions/upload-artifact@v4
      with:
        name: merged-report
        path: merged-report
