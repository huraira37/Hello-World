merge-reports: 
  needs: test 
  runs-on: ubuntu-latest-16-core-internal
  steps: 
    - name: Download all test results 
      uses: actions/download-artifact@v4 
      with: 
        path: all-artifacts

    - name: Set npm config to avoid SSL issues
      run: npm config set strict-ssl false

    - name: Cache npm dependencies
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-npm-cache

    - name: Install Monocart CLI
      run: npm install monocart

    - name: Merge Monocart reports
      run: |
        npx monocart merge all-artifacts/**/index.json -o results/merged-report.json

    - name: Generate final Monocart report
      run: |
        npx monocart merge results/merged-report.json -o merged-report

    - name: Upload merged report
      uses: actions/upload-artifact@v4
      with:
        name: merged-report
        path: merged-report
