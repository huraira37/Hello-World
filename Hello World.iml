DISPLAY=:99 npx playwright test ${{ matrix.group.file }} \
  --project="Google Chrome" \
  --workers=1 \
  --headed \
  --reporter=list,json:./test-results/report.json \
  2>&1 | tee test_output.txt || EXIT_CODE=$?



- name: Upload raw test result JSON
  if: always()
  uses: actions/upload-artifact@v4
  with:
    name: Raw-Results-${{ matrix.group.name }}
    path: ./Playwright-Automation/test-results/report.json



import { merge, generate } from 'monocart-reporter';
import { globSync } from 'glob';

const run = async () => {
  const files = globSync('../raw-collection/**/report.json');
  console.log(`Found ${files.length} raw JSON files to merge`);
  files.forEach(f => console.log(' → ' + f));

  if (!files.length) {
    console.error('❌ No raw JSON files found to merge!');
    process.exit(1);
  }

  const mergedJson = './merged-results.json';
  const outputHtml = './merged-report/index.html';

  await merge({
    files,
    output: mergedJson
  });

  console.log(`✅ Merged data saved to ${mergedJson}`);

  await generate({
    resultFile: mergedJson,
    outputFile: outputHtml
  });

  console.log(`✅ Monocart report generated at ${outputHtml}`);
};

run();



 steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Download raw JSON reports
      uses: actions/download-artifact@v4
      with:
        path: raw-collection

    - name: Debug: Confirm report.json files exist
      run: |
        echo "Raw JSON files:"
        find raw-collection -name report.json

    - name: Set npm registry to avoid E503
      run: npm config set registry https://registry.npmmirror.com/

    - name: Install dependencies
      run: npm ci
      working-directory: ./Playwright-Automation

    - name: Merge + Generate HTML report
      run: node merge-monocart.mjs
      working-directory: ./Playwright-Automation

    - name: Upload merged HTML report
      uses: actions/upload-artifact@v4
      with:
        name: merged-report
        path: Playwright-Automation/merged-report

