    - name: Run Playwright Tests
      id: run_tests
      run: |
        set -o pipefail
        EXIT_CODE=0

        # Only specify test file and other CLI options â€” reporter is handled in config
        DISPLAY=:99 npx playwright test ${{ matrix.group.file }} \
          --project="Google Chrome" \
          --workers=1 \
          --headed \
          2>&1 | tee test_output.txt || EXIT_CODE=$?

        echo "Test exit code: $EXIT_CODE"
        echo "exit-code=$EXIT_CODE" >> $GITHUB_OUTPUT

        # Flaky test detection
        if [ -f ./test-results/report.json ]; then
          if grep -q '"status": "flaky"' ./test-results/report.json; then
            echo "Flaky tests detected in ${{ matrix.group.file }}."
            exit 1
          fi
        else
          echo "Warning: report.json not found for flaky test detection."
        fi

        exit $EXIT_CODE
      working-directory: ./Playwright-Automation
      continue-on-error: true
