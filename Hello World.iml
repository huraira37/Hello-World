
    # ‚úÖ Download Final-Report.zip created by the aggregate job
    - name: Download Final Combined Artifact Zip
      uses: actions/download-artifact@v4
      with:
        name: Final-Combined-Report
        path: extracted

    # ‚úÖ Unzip the artifact into the working directory (flatten folder structure)
    - name: Unzip combined report
      run: |
        unzip -q extracted/Final-Report.zip -d .

    # ‚úÖ Debug: Show all files and their types inside all-artifacts
    - name: Full Tree Dump (Debug)
      run: |
        echo "===== BEGIN DEBUG: file list & types ====="
        find all-artifacts -type f -exec file {} \;
        echo "===== END DEBUG ====="

    - name: Cache npm dependencies
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-npm-cache

    - name: Set npm registry to Cloudflare mirror (avoid E503)
      run: npm config set registry https://registry.npmmirror.com/

    - name: Install dependencies
      run: npm ci
      working-directory: ./Playwright-Automation

    # ‚úÖ Merge Monocart reports with debug printout of file paths
    - name: Merge Monocart reports using monocart-reporter
      run: node merge-monocart.mjs
      working-directory: ./Playwright-Automation

    # ‚úÖ List final merged report folder to verify success
    - name: Debug: List merged report directory
      run: |
        echo "Checking contents of merged-report:"
        ls -R merged-report || echo "merged-report folder not found"

    - name: Upload merged report
      uses: actions/upload-artifact@v4
      with:
        name: merged-report
        path: merged-report


*******************************************************************************

import { merge } from 'monocart-reporter';
import { globSync } from 'glob';
import fs from 'fs';

const run = async () => {
  try {
    const files = globSync('../all-artifacts/**/Monocart-*/index.json');

    console.log(`üß© Found ${files.length} report(s) to merge`);
    console.log('üîç Matching files:');
    files.forEach(f => console.log(' ‚Üí ' + f));

    if (files.length === 0) {
      throw new Error('No valid Monocart report files found.');
    }

    await merge({
      files,
      output: '../merged-report'
    });

    console.log('‚úÖ Merged report created at ../merged-report');
  } catch (error) {
    console.error('‚ùå Merge failed:', error);
    process.exit(1);
  }
};

run();
