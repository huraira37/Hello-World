steps: 
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Download all raw result artifacts
      uses: actions/download-artifact@v4
      with:
        path: raw-collection

    - name: Debug: List raw JSON files
      run: |
        echo "üîç Verifying downloaded report.json files:"
        find raw-collection -name report.json

    - name: Set npm registry to Cloudflare mirror
      run: npm config set registry https://registry.npmmirror.com/

    - name: Install dependencies
      run: npm ci
      working-directory: ./Playwright-Automation

    # ‚úÖ Merge raw JSONs into one
    - name: Merge Monocart reports using monocart-reporter
      run: node merge-monocart.mjs
      working-directory: ./Playwright-Automation

    # ‚úÖ Generate HTML from merged JSON
    - name: Generate final Monocart HTML report
      run: |
        npx monocart-reporter generate ../merged-results.json --output merged-report
      working-directory: ./Playwright-Automation

    - name: Upload merged report
      uses: actions/upload-artifact@v4
      with:
        name: merged-report
        path: Playwright-Automation/merged-report
