needs: test
    if: always()
    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Configure .npmrc for public monocart-reporter # âœ… NEW
      run: |
        echo "monocart-reporter:registry=https://registry.npmjs.org/" >> .npmrc

    - name: Download all artifacts
      uses: actions/download-artifact@v4
      with:
        path: ./all-artifacts

    - name: List all downloaded files
      run: find ./all-artifacts

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install monocart-reporter
      run: npm install monocart-reporter --save-dev

    - name: Merge Monocart result.json reports
      run: |
        mkdir -p merged-jsons
        find ./all-artifacts -type f -name "result.json" -exec cp {} merged-jsons/ \;
        npx monocart-reporter merge merged-jsons/*.json -o ./final-monocart-report

    - name: Upload Unified Monocart Dashboard
      uses: actions/upload-artifact@v4
      with:
        name: Unified-Monocart-Report
        path: ./final-monocart-report
        retention-days: 15

    - name: Zip all raw artifacts
      run: zip -r Final-Report.zip ./all-artifacts

    - name: Upload Final Combined Report ZIP
      uses: actions/upload-artifact@v4
      with:
        name: Final-Combined-Report
        path: Final-Report.zip
        retention-days: 15
