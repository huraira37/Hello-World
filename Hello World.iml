merge-reports: 
  needs: test 
  runs-on: ubuntu-latest-16-core-internal
  steps: 
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Download all test results 
      uses: actions/download-artifact@v4 
      with: 
        path: all-artifacts

    - name: Cache npm dependencies
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-npm-cache

    - name: Set npm config to avoid SSL issues
      run: npm config set strict-ssl false

    - name: Install dependencies
      run: npm ci
      working-directory: ./Playwright-Automation

    - name: Merge Monocart reports
      run: |
        npx monocart merge ../../all-artifacts/**/index.json -o results/merged-report.json
      working-directory: ./Playwright-Automation

    - name: Generate final Monocart report
      run: |
        npx monocart merge results/merged-report.json -o merged-report
      working-directory: ./Playwright-Automation

    - name: Upload merged report
      uses: actions/upload-artifact@v4
      with:
        name: merged-report
        path: Playwright-Automation/merged-report
